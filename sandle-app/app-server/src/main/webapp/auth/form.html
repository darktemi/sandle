<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <title>산들 - 로그인</title>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css"
    />
    <link rel="stylesheet" href="./form.css">
  </head>
  <body>
    <h1>Welcome to Sandle Login</h1>

    <form id="login-form" action="login" method="post">

      
      <input
        type="email"
        placeholder="사용자 이메일 주소 입력해주세요."
        name="email" value=""
        required
      />
      <input
        type="password"
        placeholder="비밀번호를 입력해주세요."
        name="password"
        required
      />
      <label class="Remember"
        ><input type="checkbox" name="remember" />이메일 기억</label
      >
      <button type="submit">로그인</button>
      <div class="Social">
        <button type="submit" class="google-btn">
          <i class="fa fa-google" aria-hidden="true"></i> Login with Google
        </button>
        <button type="submit" class="facebook-btn">
          <i class="fa fa-facebook" aria-hidden="true"></i> Login with Facebook
        </button>
      </button>
      <button type="submit" class="naver-btn">
        <i class="naver" aria-hidden="true"></i> Login with Naver
      </button>
    </button>
    <button type="submit" class="kakao-btn">
      <i class="kakao" aria-hidden="true"></i> Login with Kakao
    </button>
      </div>
      <div class="bottom-container">
        <div class="row">
          <div class="col">
            <a href="#" style="color:white" class="btn">Sign up</a>
            <br>
            <a href="#" style="color:white" class="btn">Forgot password?</a>
        </div>
      </div>
    </form>

    <script>
      document.querySelector('input[name="email"]').value = getCookie("email");

      document.querySelector("#btn-login").onclick = () => {
        // 이메일을 쿠키에 보관
        if (document.querySelector('input[type="checkbox"]:checked') != null) {
          setCookie(
            "email",
            document.querySelector('input[name="email"]').value,
            60 * 60 * 24 * 7
          );
        } else {
          setCookie("email", "", 0);
        }

        const form = document.querySelector("#login-form");
        const formData = new FormData(form);

        fetch("login", {
          method: "post",
          body: formData,
        })
          .then((response) => {
            return response.json();
          })
          .then((result) => {
            if (result.status == "success") {
              alert("로그인 success!");
              location.href = "../";
            } else {
              alert("로그인 실패!");
              document.querySelector('input[name="email"]').value = "";
              document.querySelector('input[name="password"]').value = "";
            }
          })
          .catch((exception) => {
            alert("로그인 오류!");
            console.log(exception);
          });
      };

      function getCookie(cookieName) {
        var cookieValue = null;
        if (document.cookie) {
          var array = document.cookie.split(escape(cookieName) + "=");
          if (array.length >= 2) {
            var arraySub = array[1].split(";");
            cookieValue = unescape(arraySub[0]);
          }
        }
        return cookieValue;
      }

      function setCookie(
        cookieName,
        cookieValue,
        cookieMaxAge,
        cookiePath,
        cookieDomain,
        cookieSecure
      ) {
        var cookieText =
          encodeURIComponent(cookieName) +
          "=" +
          encodeURIComponent(cookieValue);
        cookieText += cookieMaxAge ? "; max-age=" + cookieMaxAge : "";
        cookieText += cookiePath ? "; path=" + cookiePath : "";
        cookieText += cookieDomain ? "; domain=" + cookieDomain : "";
        cookieText += cookieSecure ? "; secure" : "";
        document.cookie = cookieText;
      }
    </script>
  </body>
</html>
